
> Q. 동시에 같은 `DB Table row`
 를 업데이트 하는 상황을 방어하기 위해 어떻게 개발하실 건지 설명해주세요.
> 

## 💡 동시성 제어란?

- 동시에 작동하는 다중 트랜잭션의 상호 간섭 작용에서 데이터베이스를 보호하는 것
- 동시성 제어를 위해 DBMS에서는 공통적으로 **Lock 기능**을 제공함
    
    → 여러 사용자가 데이터를 동시에 액세스하는 것처럼 보이지만 내부적으로 하나씩 실행되도록 트랜잭션을 직렬화하는 것
    
- 동시성 제어의 목표는 동시에 실행되는 트랜잭션 수를 최대화하면서도 입력, 수정, 삭제, 검색 시 데이터 무결성을 유지하는 것
- DBMS가 제공하는 set transaction 명령어로는 모든 동시성 제어 문제를 해결할 수 없기 때문에 개발자가 동시성을 구현하여 함. 트랜잭션의 동시성 제어 기법에는 비관적 동시성 제어와 낙관적 동시성 제어가 있음

## 💡 비관적 동시성 제어(Pessimistic Concurrency Control)

- **사용자들이 같은 데이터를 동시에 수정할 것**이라고 가정함
- 데이터를 읽는 시점에 Lock을 걸고 트랜잭션이 완료될 때까지 이를 유지
- select 시점에 Lock을 거는 비관적 동시성 제어는 자칫 시스템 동시성을 심각하게 떨어뜨릴 수 있음. wait 또는 nowait 옵션을 함께 사용하는 것이 바람직함
    - for update nowait → 대기없이 Exception을 던짐
    - for update wait 3 → 3초 대기 후 Exception을 던짐

## 💡 낙관적 동시성 제어(Optimistic Concurrency Control)

- **사용자들이 같은 데이터를 동시에 수정하지 않을 것**이라고 가정함
- 따라서 데이터를 읽을 때는 Lock을 설정하지 않음
- 단, **수정 시점에서 다른 사용자에 의해 값이 변경됐는지**를 반드시 검사함
